<%@ page contentType="text/html; charset=UTF-8"%>
<!DOCTYPE html>
<html>
    <head>
      <!-- 포트원 SDK 라이브러리 추가 -->
      <script src="https://cdn.iamport.kr/v1/iamport.js"></script>
      
      <script>
   // 객체 초기화
        var IMP = window.IMP;
        IMP.init('imp87501644');

        function requestPay() {
          // 결제창 호출      
        	IMP.request_pay({
        	    pg : 'kakaopay',
        	    pay_method : 'card', //생략 가능
        	    merchant_uid: `payment-${crypto.randomUUID()}`, // 상점에서 관리하는 주문 번호 계속 바뀌어야 함.
        	    name : '주문명:결제테스트',
        	    amount : 9900,
        	    buyer_email : 'iamport@siot.do',
        	    buyer_name : '구매자이름',
        	    buyer_tel : '010-1234-5678',
        	    buyer_addr : '서울특별시 강남구 삼성동',
        	    buyer_postcode : '123-456'
        	}, async (response) => {
        	    if (response.error_code != null) {
        	        return alert(`결제에 실패하였습니다. 에러 내용: ${response.error_msg}`);
        	      }

        	      // 고객사 서버에서 /payment/complete 엔드포인트를 구현해야 합니다.
        	      // (다음 목차에서 설명합니다)
        	      const notified = await fetch(`${SERVER_BASE_URL}/payment/complete`, {
        	        method: "POST",
        	        headers: { "Content-Type": "application/json" },
        	        // imp_uid와 merchant_uid, 주문 정보를 서버에 전달합니다
        	        body: JSON.stringify({
        	          imp_uid: response.imp_uid,
        	          merchant_uid: response.merchant_uid,
        	          // 주문 정보...
        	        }),
        	      });
        	    },
        	  );
      }
      </script>
      <meta charset="UTF-8" />
      <title>Sample Payment</title>
    </head>
    <body>
      <!-- 결제하기 버튼 생성 -->
      <button onclick="requestPay()">결제하기</button>
    </body>
  </html>
